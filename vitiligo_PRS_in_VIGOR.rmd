---
title: "Compute Vitiligo PRS in VIGOR Cohort"
author: "Gen Roberts"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(here, lib.loc="/home/genevieve.roberts-umw/R/x86_64-conda-linux-gnu-library/4.2")
library(dbplyr, lib.loc = "/share/pkg/conda/r/4.2.2/lib/R/library")
library(tidyverse, lib.loc = "/share/pkg/conda/r/4.2.2/lib/R/library")
library(data.table)
#library(BiocManager, lib.loc = "/share/pkg/conda/r/4.2.2/lib/R/library")
#BiocManager::install("biomaRt", lib = "/home/genevieve.roberts-umw/R/x86_64-conda-linux-gnu-library/4.2")
library(biomaRt, lib.loc="/home/genevieve.roberts-umw/R/x86_64-conda-linux-gnu-library/4.2")

#so that biomaRt works
httr::set_config(httr::config(ssl_verifypeer = FALSE))
```


```{r}
listEnsembl(GRCh=38, mirror='uswest')
```

```{r}
snp_mart <- useMart(biomart="ENSEMBL_MART_SNP", host="grch37.ensembl.org",
                    path="/biomart/martservice", dataset="hsapiens_snp")
```

```{r}
rescue_rsid <- function(db, chr_col = "CHR", start_col = "chr_start", end_col = "chr_end") {
  # Validate input column names
  if (!(chr_col %in% colnames(db)) || !(start_col %in% colnames(db)) || !(end_col %in% colnames(db))) {
    stop("Specified column names do not exist in the input dataframe.")
  }
  
  # Extract the values based on parameterized column names
  temp <- getBM(
    attributes = c('refsnp_id', 'allele', 'chrom_start'), 
    filters = c('chr_name', 'start', 'end'), 
    values = list(
      db[[chr_col]], 
      db[[start_col]], 
      db[[end_col]]
    ), 
    mart = snp_mart
  )
  
  return(temp)
}
```




---------------------------------



```{r}
weights_path <- str_c(here(), "/Vitiligo_Risk_Score_Weights_Roberts2019.csv")
weights <- fread(weights_path)
snps <- weights$SNP
```

```{r}
test=rescue_rsid(head(weights, 1), chr_col = "chr", start_col = "pos", end_col = "pos")
test
```


```{r}
test2=rescue_rsid_synonyms(head(weights, 1), rsid_col="SNP")
test2
```








```{r}
bim_path <- "/pi/manuel.garber-umw/human/VIGOR/tj/ibd/all_samples_qc.bim"
bim <- fread(bim_path)
```

```{r}
sample_n(bim, 5)
```

